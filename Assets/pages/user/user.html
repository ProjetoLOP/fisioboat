<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fisioboat - Pedro Costa</title>
    <link rel="stylesheet" href="/Assets/pages/user/user.css">
</head>

<body>
    <div class="floating-particles" id="particles"></div>

    <header class="header">
        <a href="/">
            <div class="logo">FISIOBOAT</div>
        </a>
        <a href="/">
            <button class="back-btn">‚Üê Voltar</button>
        </a>
    </header>

    <div class="container">
        <div class="player-card">
            <div class="player-avatar">PC</div>
            <div class="player-info">
                <div class="player-name">Pedro Costa</div>
                <div class="player-details">Idade: 32 | Altura: 1,78m | Peso: 74kg</div>
            </div>
            <button class="start-session-btn" onclick="startNewSession()">Iniciar Nova Sess√£o</button>
        </div>

        <div class="history-section">
            <div class="section-title">
                <div class="section-icon">üìä</div>
                Hist√≥rico de Sess√µes
            </div>

            <div class="session-grid">
                <div class="session-item">
                    <div class="session-date">
                        <div class="date-icon">üìÖ</div>
                        20/08/2025
                    </div>
                    <div class="session-stats">
                        <div style="display: flex; gap: 1rem;">
                            <div class="stat-group">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <span>12 min</span>
                            </div>
                            <div class="stat-group">
                                <div class="stat-icon">üîÅ</div>
                                <span>30 repeti√ß√µes</span>
                            </div>
                        </div>
                        <div class="star-rating">‚≠ê</div>
                    </div>
                </div>

                <div class="session-item">
                    <div class="session-date">
                        <div class="date-icon">üìÖ</div>
                        15/08/2025
                    </div>
                    <div class="session-stats">
                        <div style="display: flex; gap: 1rem;">
                            <div class="stat-group">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <span>14 min</span>
                            </div>
                            <div class="stat-group">
                                <div class="stat-icon">üîÅ</div>
                                <span>35 repeti√ß√µes</span>
                            </div>
                        </div>
                        <div class="star-rating">‚≠ê</div>
                    </div>
                </div>

                <div class="session-item">
                    <div class="session-date">
                        <div class="date-icon">üìÖ</div>
                        15/08/20
                    </div>
                    <div class="session-stats">
                        <div style="display: flex; gap: 1rem;">
                            <div class="stat-group">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <span>7 repetidos</span>
                            </div>
                        </div>
                        <div class="star-rating">‚≠ê</div>
                    </div>
                </div>

                <div class="session-item">
                    <div class="session-date">
                        <div class="date-icon">üìÖ</div>
                        10/08/20
                    </div>
                    <div class="session-stats">
                        <div style="display: flex; gap: 1rem;">
                            <div class="stat-group">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <span>9 repetidos</span>
                            </div>
                        </div>
                        <div class="star-rating">‚≠ê</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fun√ß√£o para obter par√¢metro da URL
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Fun√ß√£o para formatar data
        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Fun√ß√£o para carregar dados do usu√°rio
        function loadUserData() {
            const userId = getUrlParameter('id');

            if (!userId) {
                console.error('ID do usu√°rio n√£o encontrado na URL');
                return;
            }

            // Buscar dados no localStorage
            const usersData = localStorage.getItem('users');
            if (!usersData) {
                console.error('Dados de usu√°rios n√£o encontrados no localStorage');
                return;
            }

            let users;
            try {
                users = JSON.parse(usersData);
            } catch (error) {
                console.error('Erro ao parsear dados dos usu√°rios:', error);
                return;
            }

            // Encontrar usu√°rio pelo ID
            const user = users.find(u => u.id === userId);
            if (!user) {
                console.error('Usu√°rio n√£o encontrado com ID:', userId);
                return;
            }

            // Atualizar avatar (primeira letra do nome)
            const playerAvatar = document.querySelector('.player-avatar');
            if (playerAvatar && user.personal_info && user.personal_info.nome) {
                playerAvatar.textContent = user.personal_info.nome.charAt(0).toUpperCase();
            }

            // Atualizar nome do jogador
            const playerName = document.querySelector('.player-name');
            if (playerName && user.personal_info && user.personal_info.nome) {
                playerName.textContent = user.personal_info.nome;
            }

            // Atualizar detalhes do jogador (idade, altura, peso)
            const playerDetails = document.querySelector('.player-details');
            if (playerDetails && user.personal_info) {
                const idade = user.personal_info.idade || 'N/A';
                const altura = user.personal_info.altura ? `${user.personal_info.altura}cm` : 'N/A';
                const peso = user.personal_info.peso ? `${user.personal_info.peso}kg` : 'N/A';
                playerDetails.textContent = `Idade: ${idade} | Altura: ${altura} | Peso: ${peso}`;
            }

            // Atualizar hist√≥rico de sess√µes
            const sessionGrid = document.querySelector('.session-grid');
            if (sessionGrid && user.sessions && user.sessions.length > 0) {
                // Limpar sess√µes existentes
                sessionGrid.innerHTML = '';

                // Ordenar sess√µes por data (mais recente primeiro)
                const sortedSessions = user.sessions.sort((a, b) => new Date(b.occurredAt) - new Date(a.occurredAt));

                // Criar elementos para cada sess√£o
                sortedSessions.forEach(session => {
                    const sessionItem = document.createElement('div');
                    sessionItem.className = 'session-item';

                    const sessionDate = formatDate(session.occurredAt);
                    const duration = Math.round(session.stats.sessionDuration);
                    const reps = session.stats.reps;

                    sessionItem.innerHTML = `
                <div class="session-date">
                    <div class="date-icon">üìÖ</div>
                    ${sessionDate}
                </div>
                <div class="session-stats">
                    <div style="display: flex; gap: 1rem;">
                        <div class="stat-group">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <span>${duration}s</span>
                        </div>
                        <div class="stat-group">
                            <div class="stat-icon">üîÅ</div>
                            <span>${reps} repeti√ß√µes</span>
                        </div>
                    </div>
                    <div class="star-rating">‚≠ê</div>
                </div>
            `;

                    // Adicionar event listener para clique
                    sessionItem.addEventListener('click', function () {
                        console.log('Abrindo detalhes da sess√£o:', session);
                        // Implementar visualiza√ß√£o de detalhes da sess√£o
                    });

                    sessionGrid.appendChild(sessionItem);
                });
            } else if (sessionGrid) {
                // Se n√£o h√° sess√µes, mostrar mensagem
                sessionGrid.innerHTML = `
            <div style="text-align: center; padding: 2rem; color: #666; grid-column: 1 / -1;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">üìä</div>
                <p>Nenhuma sess√£o registrada ainda.</p>
                <p>Clique em "Iniciar Nova Sess√£o" para come√ßar!</p>
            </div>
        `;
            }
        }

        // Executar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function () {
            loadUserData();
            createParticles();

            // Manter funcionalidade existente das part√≠culas
            function createParticles() {
                const particlesContainer = document.getElementById('particles');
                const particleCount = 20;

                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.top = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 6 + 's';
                    particlesContainer.appendChild(particle);
                }
            }
        });

        // Manter fun√ß√£o startNewSession existente
        function startNewSession() {
            const userId = getUrlParameter('id');
            if (userId) {
                window.open('Assets/scenes/game/game.html?id=' + userId, '_self');
            } else {
                console.error('ID do usu√°rio n√£o encontrado para iniciar sess√£o');
            }
        }
    </script>
</body>

</html>
