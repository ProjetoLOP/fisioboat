<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fisioboat - Pedro Costa</title>
    <link rel="stylesheet" href="/Assets/pages/user/user.css">
</head>

<body>
    <div class="floating-particles" id="particles"></div>

    <header class="header">
        <a href="/">
            <div class="logo">FISIOBOAT</div>
        </a>
        <a href="/">
            <button class="back-btn">‚Üê Voltar</button>
        </a>
    </header>

    <div class="container">
        <div class="player-card">
            <div class="player-card-main">
                <div class="player-avatar">PC</div>
                <div class="player-info">
                    <div class="player-name">Pedro Costa</div>
                    <div class="player-details">Idade: 32 | Altura: 1,78m | Peso: 74kg</div>
                </div>
                <div class="session-actions">
                    <button class="config-toggle-btn" onclick="toggleConfig()">
                        <span class="config-text">Ver op√ß√µes</span>
                        <span class="arrow">‚ñº</span>
                    </button>
                    <button class="start-session-btn" onclick="startNewSession()">Iniciar Nova Sess√£o</button>
                </div>
            </div>

            <div class="session-config-wrapper">
                <div class="session-config">
                    <div class="config-row">
                        <label>Tempo de Sess√£o (min)</label>
                        <input type="number" id="sessionTime" min="1" max="120" value="20" class="config-input">
                    </div>

                    <div class="config-row">
                        <label>Tipo da Sess√£o</label>
                        <select id="sessionType" class="config-select">
                            <option value="forca">For√ßa</option>
                            <option value="resistencia" selected>Resist√™ncia</option>
                            <option value="mista">Mista</option>
                        </select>
                    </div>

                    <div class="config-row">
                        <label>Figuras por Minuto</label>
                        <input type="number" id="figuresByMinute" min="1" max="10" value="3" class="config-input">
                    </div>

                    <div class="config-row">
                        <label>Dura√ß√£o da Figura (seg)</label>
                        <input type="number" id="figureDuration" min="1" max="6" value="4" class="config-input">
                    </div>
                </div>
            </div>
        </div>

        <!-- Adicione este HTML antes da section "history-section" no user.html -->
        <div class="analytics-section" id="analyticsSection">
            <div class="analytics-header">
                <div class="analytics-title">
                    <div class="analytics-icon">üìà</div>
                    An√°lise de Progresso
                </div>
                <div class="session-counter" id="sessionCounter">
                    0 sess√µes realizadas
                </div>
            </div>

            <!-- Resumo de Estat√≠sticas -->
            <div class="stats-summary" id="statsSummary"></div>

            <!-- Gr√°ficos -->
            <div class="charts-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-icon">üìè</div>
                        <div class="chart-title">Evolu√ß√£o de Dist√¢ncia</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="distanceChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-icon">üìä</div>
                        <div class="chart-title">Repeti√ß√µes por Minuto</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="repsChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-icon">üéØ</div>
                        <div class="chart-title">Profundidade M√©dia</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="depthChart"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-icon">‚è±Ô∏è</div>
                        <div class="chart-title">Dura√ß√£o das Sess√µes</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="durationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="history-section">
            <div class="section-title">
                <div class="section-icon">üìä</div>
                Hist√≥rico de Sess√µes
            </div>

            <div class="session-grid">
                <div class="session-item">
                    <div class="session-date">
                        <div class="date-icon">üìÖ</div>
                        20/08/2025
                    </div>
                    <div class="session-stats">
                        <div style="display: flex; gap: 1rem;">
                            <div class="stat-group">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <span>12 min</span>
                            </div>
                            <div class="stat-group">
                                <div class="stat-icon">üîÅ</div>
                                <span>30 repeti√ß√µes</span>
                            </div>
                        </div>
                        <div class="star-rating">‚≠ê</div>
                    </div>
                </div>

                <div class="session-item">
                    <div class="session-date">
                        <div class="date-icon">üìÖ</div>
                        15/08/2025
                    </div>
                    <div class="session-stats">
                        <div style="display: flex; gap: 1rem;">
                            <div class="stat-group">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <span>14 min</span>
                            </div>
                            <div class="stat-group">
                                <div class="stat-icon">üîÅ</div>
                                <span>35 repeti√ß√µes</span>
                            </div>
                        </div>
                        <div class="star-rating">‚≠ê</div>
                    </div>
                </div>

                <div class="session-item">
                    <div class="session-date">
                        <div class="date-icon">üìÖ</div>
                        15/08/20
                    </div>
                    <div class="session-stats">
                        <div style="display: flex; gap: 1rem;">
                            <div class="stat-group">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <span>7 repetidos</span>
                            </div>
                        </div>
                        <div class="star-rating">‚≠ê</div>
                    </div>
                </div>

                <div class="session-item">
                    <div class="session-date">
                        <div class="date-icon">üìÖ</div>
                        10/08/20
                    </div>
                    <div class="session-stats">
                        <div style="display: flex; gap: 1rem;">
                            <div class="stat-group">
                                <div class="stat-icon">‚è±Ô∏è</div>
                                <span>9 repetidos</span>
                            </div>
                        </div>
                        <div class="star-rating">‚≠ê</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fun√ß√£o para obter par√¢metro da URL
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Fun√ß√£o para formatar data
        function formatDate(dateString) {
            const date = new Date(dateString);
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }

        // Fun√ß√£o para formatar hora
        function formatTime(dateString) {
            const date = new Date(dateString);
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // Fun√ß√£o para formatar dura√ß√£o em segundos para minutos
        function formatDuration(seconds) {
            if (seconds < 60) {
                return `${Math.round(seconds)}s`;
            }
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = Math.round(seconds % 60);
            return remainingSeconds > 0 ? `${minutes}min ${remainingSeconds}s` : `${minutes}min`;
        }

        // Fun√ß√£o para carregar dados do usu√°rio
        function loadUserData() {
            const userId = getUrlParameter('id');

            if (!userId) {
                console.error('ID do usu√°rio n√£o encontrado na URL');
                showError('ID do usu√°rio n√£o encontrado na URL');
                return;
            }

            // Buscar dados no localStorage
            const usersData = localStorage.getItem('users');
            if (!usersData) {
                console.error('Dados de usu√°rios n√£o encontrados no localStorage');
                showError('Dados de usu√°rios n√£o encontrados');
                return;
            }

            let users;
            try {
                users = JSON.parse(usersData);
            } catch (error) {
                console.error('Erro ao parsear dados dos usu√°rios:', error);
                showError('Erro ao carregar dados dos usu√°rios');
                return;
            }

            // Validar que users √© um array
            if (!Array.isArray(users)) {
                console.error('Dados de usu√°rios corrompidos');
                showError('Dados de usu√°rios corrompidos');
                return;
            }

            // Encontrar usu√°rio pelo ID
            const user = users.find(u => u && u.id === userId);
            if (!user) {
                console.error('Usu√°rio n√£o encontrado com ID:', userId);
                showError('Usu√°rio n√£o encontrado');
                return;
            }

            // Atualizar informa√ß√µes do perfil
            updateUserProfile(user);

            // Renderizar sess√µes
            renderSessions(user);

            renderAnalytics(user);
        }

        // Fun√ß√£o para atualizar perfil do usu√°rio
        function updateUserProfile(user) {
            // Atualizar avatar (primeira letra do nome)
            const playerAvatar = document.querySelector('.player-avatar');
            if (playerAvatar && user.personal_info && user.personal_info.nome) {
                playerAvatar.textContent = user.personal_info.nome.charAt(0).toUpperCase();
            }

            // Atualizar nome do jogador
            const playerName = document.querySelector('.player-name');
            if (playerName && user.personal_info && user.personal_info.nome) {
                playerName.textContent = user.personal_info.nome;
            }

            // Atualizar detalhes do jogador (idade, altura, peso)
            const playerDetails = document.querySelector('.player-details');
            if (playerDetails && user.personal_info) {
                const idade = user.personal_info.idade || 'N/A';
                const altura = user.personal_info.altura ? `${user.personal_info.altura}cm` : 'N/A';
                const peso = user.personal_info.peso ? `${user.personal_info.peso}kg` : 'N/A';
                playerDetails.textContent = `Idade: ${idade} | Altura: ${altura} | Peso: ${peso}`;
            }
        }

        // Fun√ß√£o para renderizar sess√µes
        function renderSessions(user) {
            const sessionGrid = document.querySelector('.session-grid');

            if (!sessionGrid) {
                console.error('Container de sess√µes n√£o encontrado');
                return;
            }

            // Limpar conte√∫do existente
            sessionGrid.innerHTML = '';

            // Verificar se o usu√°rio tem sess√µes
            if (!user.sessions || typeof user.sessions !== 'object') {
                showNoSessions(sessionGrid);
                return;
            }

            // Converter objeto de sess√µes para array com IDs
            const sessionsArray = Object.entries(user.sessions).map(([id, session]) => ({
                id,
                ...session
            }));

            // Verificar se h√° sess√µes
            if (sessionsArray.length === 0) {
                showNoSessions(sessionGrid);
                return;
            }

            // Ordenar sess√µes por data (mais recente primeiro)
            const sortedSessions = sessionsArray.sort((a, b) =>
                new Date(b.occurredAt) - new Date(a.occurredAt)
            );

            // Criar cards para cada sess√£o
            sortedSessions.forEach(session => {
                const sessionCard = createSessionCard(session);
                sessionGrid.appendChild(sessionCard);
            });

            console.log(`${sortedSessions.length} sess√µes renderizadas com sucesso`);
        }

        // Fun√ß√£o para criar card de sess√£o
        function createSessionCard(session) {
            const sessionItem = document.createElement('div');
            sessionItem.className = 'session-item';
            sessionItem.setAttribute('data-session-id', session.id);

            const sessionDate = formatDate(session.occurredAt);
            const sessionTime = formatTime(session.occurredAt);

            // Extrair estat√≠sticas com valores padr√£o
            const stats = session.stats || {};
            const duration = formatDuration(stats.sessionDuration || 0);
            const reps = stats.reps || 0;
            const repsByMinute = (stats.repsByMinute || 0).toFixed(1);
            const distance = (stats.distance || 0).toFixed(2);
            const avgDepth = stats.avgDepth ? (stats.avgDepth * 100).toFixed(1) : '0.0';

            sessionItem.innerHTML = `
        <div class="session-date">
            <div class="date-icon">üìÖ</div>
            <div>
                <div>${sessionDate}</div>
                <div style="font-size: 0.85rem; opacity: 0.7; font-weight: normal;">${sessionTime}</div>
            </div>
        </div>
        <div class="session-stats">
            <div style="display: flex; flex-direction: column; gap: 0.8rem; flex: 1;">
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <div class="stat-group">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <span>${duration}</span>
                    </div>
                    <div class="stat-group">
                        <div class="stat-icon">üî¢</div>
                        <span>${reps} reps</span>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <div class="stat-group">
                        <div class="stat-icon">üìä</div>
                        <span>${repsByMinute} reps/min</span>
                    </div>
                    <div class="stat-group">
                        <div class="stat-icon">üìè</div>
                        <span>${distance}m</span>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <div class="stat-group">
                        <div class="stat-icon">üéØ</div>
                        <span>${avgDepth}cm prof.</span>
                    </div>
                </div>
            </div>
            <div class="star-rating" title="Avaliar sess√£o">‚≠ê</div>
        </div>
    `;

            // Adicionar event listener para clique
            sessionItem.addEventListener('click', function (e) {
                // N√£o abrir detalhes se clicar na estrela
                if (e.target.classList.contains('star-rating')) {
                    return;
                }
                showSessionDetails(session);
            });

            // Event listener para estrela
            const starRating = sessionItem.querySelector('.star-rating');
            starRating.addEventListener('click', function (e) {
                e.stopPropagation();
                toggleStarRating(this, session.id);
            });

            return sessionItem;
        }

        // Fun√ß√£o para mostrar mensagem quando n√£o h√° sess√µes
        function showNoSessions(container) {
            container.innerHTML = `
        <div style="text-align: center; padding: 3rem 2rem; color: #8B4513; grid-column: 1 / -1;">
            <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">üìä</div>
            <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Nenhuma sess√£o registrada</h3>
            <p style="font-size: 1.1rem; opacity: 0.7;">Clique em "Iniciar Nova Sess√£o" para come√ßar!</p>
        </div>
    `;
        }

        // Fun√ß√£o para mostrar erro
        function showError(message) {
            const container = document.querySelector('.container');
            if (container) {
                const errorDiv = document.createElement('div');
                errorDiv.style.cssText = `
            background: rgba(255, 107, 53, 0.1);
            border: 2px solid rgba(255, 107, 53, 0.3);
            border-radius: 15px;
            padding: 2rem;
            text-align: center;
            color: #8B4513;
            margin: 2rem 0;
        `;
                errorDiv.innerHTML = `
            <div style="font-size: 3rem; margin-bottom: 1rem;">‚ö†Ô∏è</div>
            <h3 style="font-size: 1.5rem; margin-bottom: 0.5rem;">Erro</h3>
            <p style="font-size: 1.1rem;">${message}</p>
        `;
                container.insertBefore(errorDiv, container.firstChild);
            }
        }

        // Fun√ß√£o para mostrar detalhes da sess√£o
        function showSessionDetails(session) {
            console.log('Detalhes da sess√£o:', session);

            const avgDepth = session.stats.avgDepth ? (session.stats.avgDepth * 100).toFixed(1) : '0.0';

            // Aqui voc√™ pode implementar um modal ou navega√ß√£o para p√°gina de detalhes
            alert(`Sess√£o #${session.id}\n\nData: ${formatDate(session.occurredAt)}\nDura√ß√£o: ${formatDuration(session.stats.sessionDuration)}\nRepeti√ß√µes: ${session.stats.reps}\nDist√¢ncia: ${session.stats.distance.toFixed(2)}m\nProfundidade M√©dia: ${avgDepth}cm`);
        }

        // Fun√ß√£o para toggle da estrela
        function toggleStarRating(starElement, sessionId) {
            if (starElement.textContent === '‚≠ê') {
                starElement.textContent = 'üåü';
                starElement.style.transform = 'scale(1.2)';
            } else {
                starElement.textContent = '‚≠ê';
                starElement.style.transform = 'scale(1)';
            }
            console.log(`Avalia√ß√£o da sess√£o ${sessionId} alterada`);
        }

        // Fun√ß√£o para criar part√≠culas
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            if (!particlesContainer) return;

            const particleCount = 20;

            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.top = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 6 + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Fun√ß√£o para iniciar nova sess√£o
        function startNewSession() {
            const userId = getUrlParameter('id');
            if (!userId) {
                console.error('ID do usu√°rio n√£o encontrado para iniciar sess√£o');
                alert('Erro: ID do usu√°rio n√£o encontrado');
                return;
            }

            const sessionConfig = getSessionConfig();
            const configParam = encodeURIComponent(JSON.stringify(sessionConfig));

            window.open(`/Assets/scenes/game/game.html?id=${userId}&sessionConfig=${configParam}`, '_self');
        }

        // Fun√ß√£o para obter configura√ß√µes da sess√£o
        function getSessionConfig() {
            const sessionTime = document.getElementById('sessionTime')?.value || 20;
            const sessionType = document.getElementById('sessionType')?.value || 'resistencia';
            const figuresByMinute = document.getElementById('figuresByMinute')?.value || 3;
            const figuresDuration = document.getElementById('figureDuration')?.value || 4;

            const config = {
                sessionDuration: parseInt(sessionTime, 10),
                sessionType: sessionType,
                figuresByMinute: parseInt(figuresByMinute, 10),
                figuresDuration: parseInt(figuresDuration, 10)
            };

            console.log('Configura√ß√µes da Sess√£o:', config);
            return config;
        }

        // Fun√ß√£o para toggle do config
        function toggleConfig() {
            const wrapper = document.querySelector('.session-config-wrapper');
            const btn = document.querySelector('.config-toggle-btn');

            if (wrapper && btn) {
                wrapper.classList.toggle('expanded');
                btn.classList.toggle('active');
            }
        }

        // Executar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function () {
            loadUserData();
            createParticles();
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // Configura√ß√£o global dos gr√°ficos
        Chart.defaults.font.family = 'system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto';
        Chart.defaults.color = '#6B4423';

        let charts = {}; // Armazena refer√™ncias aos gr√°ficos

        // Fun√ß√£o para renderizar analytics
        function renderAnalytics(user) {
            const analyticsSection = document.getElementById('analyticsSection');

            if (!user.sessions || typeof user.sessions !== 'object') {
                return;
            }

            const sessionsArray = Object.entries(user.sessions).map(([id, session]) => ({
                id,
                ...session
            }));

            // Verificar se h√° pelo menos 3 sess√µes
            if (sessionsArray.length < 3) {
                return;
            }

            // Mostrar se√ß√£o de analytics
            analyticsSection.classList.add('visible');

            // Atualizar contador de sess√µes
            const sessionCounter = document.getElementById('sessionCounter');
            sessionCounter.textContent = `${sessionsArray.length} sess√µes realizadas`;

            // Ordenar por data
            const sortedSessions = sessionsArray.sort((a, b) =>
                new Date(a.occurredAt) - new Date(b.occurredAt)
            );

            // Gerar resumo de estat√≠sticas
            generateStatsSummary(sortedSessions);

            // Criar gr√°ficos
            createDistanceChart(sortedSessions);
            createRepsChart(sortedSessions);
            createDepthChart(sortedSessions);
            createDurationChart(sortedSessions);
        }

        // Fun√ß√£o para gerar resumo de estat√≠sticas
        function generateStatsSummary(sessions) {
            const statsSummary = document.getElementById('statsSummary');

            // Calcular estat√≠sticas totais
            const totalDistance = sessions.reduce((sum, s) => sum + (s.stats.distance || 0), 0);
            const totalReps = sessions.reduce((sum, s) => sum + (s.stats.reps || 0), 0);
            const avgRepsPerMin = sessions.reduce((sum, s) => sum + (s.stats.repsByMinute || 0), 0) / sessions.length;
            const avgDepth = sessions.reduce((sum, s) => sum + (s.stats.avgDepth || 0), 0) / sessions.length;

            // Calcular tend√™ncias (comparar √∫ltimas 3 com 3 anteriores)
            const recentSessions = sessions.slice(-3);
            const previousSessions = sessions.slice(-6, -3);

            const recentAvgDistance = recentSessions.reduce((sum, s) => sum + (s.stats.distance || 0), 0) / recentSessions.length;
            const previousAvgDistance = previousSessions.length > 0
                ? previousSessions.reduce((sum, s) => sum + (s.stats.distance || 0), 0) / previousSessions.length
                : recentAvgDistance;

            const distanceTrend = calculateTrend(recentAvgDistance, previousAvgDistance);

            statsSummary.innerHTML = `
                <div class="summary-card">
                    <div class="summary-icon">üìè</div>
                    <div class="summary-value">${totalDistance.toFixed(2)}m</div>
                    <div class="summary-label">Dist√¢ncia Total</div>
                    ${distanceTrend}
                </div>
                <div class="summary-card">
                    <div class="summary-icon">üî¢</div>
                    <div class="summary-value">${totalReps}</div>
                    <div class="summary-label">Total de Repeti√ß√µes</div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">üìä</div>
                    <div class="summary-value">${avgRepsPerMin.toFixed(1)}</div>
                    <div class="summary-label">M√©dia Reps/Min</div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">üéØ</div>
                    <div class="summary-value">${(avgDepth * 100).toFixed(1)}cm</div>
                    <div class="summary-label">Profundidade M√©dia</div>
                </div>
            `;
        }

        // Fun√ß√£o para calcular tend√™ncia
        function calculateTrend(current, previous) {
            const difference = ((current - previous) / previous) * 100;

            if (Math.abs(difference) < 5) {
                return '<div class="trend-indicator trend-neutral">‚Üí Est√°vel</div>';
            } else if (difference > 0) {
                return `<div class="trend-indicator trend-up">‚Üë +${difference.toFixed(1)}%</div>`;
            } else {
                return `<div class="trend-indicator trend-down">‚Üì ${difference.toFixed(1)}%</div>`;
            }
        }

        // Fun√ß√£o para criar gr√°fico de dist√¢ncia
        function createDistanceChart(sessions) {
            const ctx = document.getElementById('distanceChart');

            // Destruir gr√°fico anterior se existir
            if (charts.distance) {
                charts.distance.destroy();
            }

            const labels = sessions.map((s, i) => `#${i + 1}`);
            const data = sessions.map(s => s.stats.distance || 0);

            charts.distance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Dist√¢ncia (m)',
                        data: data,
                        borderColor: '#ff6b35',
                        backgroundColor: 'rgba(255, 107, 53, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: '#ff6b35',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: { size: 14 },
                            bodyFont: { size: 13 },
                            callbacks: {
                                label: function (context) {
                                    return `Dist√¢ncia: ${context.parsed.y.toFixed(2)}m`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para criar gr√°fico de repeti√ß√µes por minuto
        function createRepsChart(sessions) {
            const ctx = document.getElementById('repsChart');

            if (charts.reps) {
                charts.reps.destroy();
            }

            const labels = sessions.map((s, i) => `#${i + 1}`);
            const data = sessions.map(s => s.stats.repsByMinute || 0);

            charts.reps = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Reps/Min',
                        data: data,
                        backgroundColor: 'rgba(255, 107, 53, 0.7)',
                        borderColor: '#ff6b35',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: function (context) {
                                    return `Reps/Min: ${context.parsed.y.toFixed(1)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para criar gr√°fico de profundidade
        function createDepthChart(sessions) {
            const ctx = document.getElementById('depthChart');

            if (charts.depth) {
                charts.depth.destroy();
            }

            const labels = sessions.map((s, i) => `#${i + 1}`);
            const data = sessions.map(s => (s.stats.avgDepth || 0) * 100);

            charts.depth = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Profundidade (cm)',
                        data: data,
                        borderColor: '#f7931e',
                        backgroundColor: 'rgba(247, 147, 30, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointBackgroundColor: '#f7931e',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: function (context) {
                                    return `Profundidade: ${context.parsed.y.toFixed(1)}cm`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Fun√ß√£o para criar gr√°fico de dura√ß√£o
        function createDurationChart(sessions) {
            const ctx = document.getElementById('durationChart');

            if (charts.duration) {
                charts.duration.destroy();
            }

            const labels = sessions.map((s, i) => `#${i + 1}`);
            const data = sessions.map(s => (s.stats.sessionDuration || 0) / 60);

            charts.duration = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Dura√ß√£o (min)',
                        data: data,
                        backgroundColor: 'rgba(247, 147, 30, 0.7)',
                        borderColor: '#f7931e',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: function (context) {
                                    return `Dura√ß√£o: ${context.parsed.y.toFixed(1)} min`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>

</html>